<!-- TODO add video upload to S3 -->
<template name="addReport">
    {{#if currentUser}}
        {{> reportForm}}
    {{else}}
        {{> accessDenied}}
    {{/if}}
</template>

<template name="reportForm">
    <form class="main form page" id="formAddReport">
        <div class="form-group">

            {{#with field="title"}}
                {{> displayError}}
            {{/with}}

            <label class="control-label" for="title">Title</label>
            <div class="controls">
                <input name="title" id="title" type="text" value="{{title}}" placeholder="Your Title" class="form-control"/>
            </div>
        </div>

        <div class="form-group">

            {{#with field="eventDate"}}
                {{> displayError}}
            {{/with}}

            <label class="control-label" for="eventDate">Event Date</label>
            <div class="controls">
                <div class="input-group datetimepicker">
                    <span class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i></span>
                    <input class="set-due-date form-control" name="eventDate" type="text"/>
                </div>
            </div>
        </div>

        <div class="form-group">

            {{#with field="explanation"}}
                {{> displayError}}
            {{/with}}

            <label class="control-label" for="explanation">Explanation</label>
            <div class="controls">
                <textarea class="form-control" rows="3" name="explanation" value="{{explanation}}" id="explanation"></textarea>
            </div>
        </div>

        <div class="form-group">

            {{#with field="kind"}}
                {{> displayError}}
            {{/with}}

            <label class="control-label" for="kind">Kind</label>
            <div class="controls">
                <select name="kind" id="kind" class="form-control">
                    <option selected="{{isEqual kind 'Harassment'}}">Harassment</option>
                    <option selected="{{isEqual kind 'Violence'}}">Violence</option>
                </select>
            </div>
        </div>

        <div class="form-group">
            <div class="controls">
                <label class="control-label" for="link">Add Links</label>
                <div class="input-group">
                    <input name="link" type="text" id="link" class="form-control">
                    <div class="input-group-btn">
                        <input type="submit" value="Add" name="addLink" class="btn btn-secondary"/>
                    </div>

                </div>

            </div>
        </div>

        <div class="form-group">
            <div class="controls">
                <label class="control-label" for="fileToUpload">Upload Photos</label>
                <input name="fileToUpload" type="file" class="form-control" id="fileToUpload" accept="image/*">
            </div>
        </div>



        <div class="form-group">
            <div class="controls">
                <label class="control-label" for="documentToUpload">Upload PDFs</label>
                <input name="documentToUpload" class="form-control" type="file" id="documentToUpload" accept="application/pdf">
            </div>
        </div>
        {{> searchBox}}

        <input type="submit" value="Submit" class="btn btn-primary"/>
        <div class="form-group">
            {{#if aggressors}}
                <h4>Aggressors Added</h4>
            {{/if}}

            {{#each aggressors}}



            {{#with (aggressorWithId this)}}
            {{name}} {{lastName}} <br/>({{#each aliases}}{{this}} {{/each}})<br/>
            {{/with}}


            {{/each}}

        </div>
        <div class="form-group">
            {{#if links}}
                <h4>Links Added</h4>
            {{/if}}

            {{#each links}}




                <a href="{{this}}" target="_blank">{{this}}</a><br/>



            {{/each}}

        </div>
        <div class="form-group">
            {{#if documents}}
                <h4>PDFs Uploaded</h4>
            {{/if}}

                {{#each documents}}




                            <a href="{{url}}" target="_blank">{{name}}</a><br/>



                {{/each}}

        </div>
        <div class="form-group">
            {{#if photos}}
            <h4>Photos Uploaded</h4>
            {{/if}}
            <div class="row">
                {{#each photos}}
                    <div class="col-sm-6 col-md-3">
                        <div class="thumbnail">


                            <img src="{{this}}"/>

                        </div>
                    </div>
                {{/each}}
            </div>
        </div>







    </form>
</template>


<template name="displayError">
    {{#if (errorsForField field)}}
        <div class="alert alert-danger" role="alert">
            <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
            <span class="sr-only">Error:</span>
            {{errorsForField field}}
        </div>
    {{/if}}
</template>

<template name="progressBar">
    <div class="progress">
        <div class="progress-bar" role="progressbar" aria-valuenow="{{progress}}" aria-valuemin="0" aria-valuemax="100" style="width: {{progress}}%;">
            <span class="sr-only">{{progress}}% Complete</span>
        </div>
    </div>
</template>

<template name="searchBox">
    {{> esInput index="aggressors" placeholder="Search..." class="form-control box"}}

    <ul>


        {{#ifEsIsSearching index="aggressors"}}
            <div>Loading...</div>
        {{else}}
            <div class="results-wrapper">
            {{#esEach index="aggressors"}}
                {{#if (isAdded this._id)}}
                    {{else}}
                    <li>Name of the aggressor: {{name}} {{lastName}} ({{#each aliases}}{{this}} {{/each}})
                        <input id="addToReport" type="button" class="btn btn-secondary" value="Add to report"/>
                    </li>
                {{/if}}

            {{/esEach}}

            </div>
            {{> esLoadMoreButton index="aggressors"}}
        {{/ifEsIsSearching}}
        {{#ifEsHasNoResults index="aggressors"}}
            <div class="no-results">No results found!</div>
        {{/ifEsHasNoResults}}
        {{#ifEsInputIsEmpty index="aggressors"}}
        {{else}}
            <li><input id="addWithAlias" type="button" class="btn btn-secondary" value="Add Aggressor with '{{searchTerm}}' alias"/></li>
        {{/ifEsInputIsEmpty}}
    </ul>
</template>